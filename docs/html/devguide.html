<HTML
><HEAD
><TITLE
>Developer's Guide</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.73
"><LINK
REL="HOME"
TITLE="phpBugTracker"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Configuration Options"
HREF="configuration.html"><LINK
REL="NEXT"
TITLE="Development Standards"
HREF="devstandards.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="docs.css"></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#800080"
ALINK="#FF0000"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>phpBugTracker</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="configuration.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="devstandards.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="DEVGUIDE"
>Chapter 3. Developer's Guide</A
></H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>3.1. <A
HREF="devguide.html#DEPENDENCIES"
>Dependencies</A
></DT
><DD
><DL
><DT
>3.1.1. <A
HREF="devguide.html#DEP-PHPLIB"
>PHPlib</A
></DT
><DT
>3.1.2. <A
HREF="devguide.html#DEP-JPGRAPH"
>JpGraph</A
></DT
></DL
></DD
><DT
>3.2. <A
HREF="devstandards.html"
>Development Standards</A
></DT
><DD
><DL
><DT
>3.2.1. <A
HREF="devstandards.html#DEVSTANDARDS-CODE"
>Coding Standards</A
></DT
><DT
>3.2.2. <A
HREF="devstandards.html#OTHERCONVENTIONS"
>Other Conventions</A
></DT
></DL
></DD
><DT
>3.3. <A
HREF="schema.html"
>Database Schema</A
></DT
></DL
></DIV
><BLOCKQUOTE
CLASS="ABSTRACT"
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN254"
></A
><P
>Adding on to or extending phpBugTracker should be easy for those with a knowledge of PHP and SQL.  New developers are always welcome to join the project at <A
HREF="http://www.sourceforge.net/projects/phpbt/"
TARGET="_top"
>http://www.sourceforge.net/projects/phpbt</A
>, or to simply submit patches, bug reports, or feature requests.</P
></DIV
></BLOCKQUOTE
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DEPENDENCIES"
>3.1. Dependencies</A
></H1
><BLOCKQUOTE
CLASS="ABSTRACT"
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN259"
></A
><P
>phpBugTracker requires one external package, PHPlib, and can optionally use JpGraph.  Of course a web server running a version of PHP later than 4.0 and a database server are also necessary.</P
></DIV
></BLOCKQUOTE
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DEP-PHPLIB"
>3.1.1. PHPlib</A
></H2
><P
>PHPlib can be found at <A
HREF="http://phplib.sourceforge.net/"
TARGET="_top"
>http://phplib.sourceforge.net</A
>.  It provides the database abstraction layer, html templates, and session and authentication management.</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN265"
>3.1.1.1. Database Abstraction</A
></H3
><P
>Instead of using PHP's database functions directly, interactions are done via database objects, which extend PHPlib's <TT
CLASS="CLASSNAME"
>DB_Sql</TT
> class.</P
><P
>The global variable <TT
CLASS="VARNAME"
>$q</TT
> is available as an instance of the class <TT
CLASS="CLASSNAME"
>dbclass</TT
>.  This class adds two functions to the <TT
CLASS="CLASSNAME"
>DB_Sql</TT
> class, <TT
CLASS="FUNCTION"
>grab()</TT
> and <TT
CLASS="FUNCTION"
>grab_field()</TT
>.  If they are called with an argument, the argument is passed as a query to the database and the results are returned from that query.  If no argument is passed, they return results from the previous call to <TT
CLASS="FUNCTION"
>query()</TT
>.  Here are some examples:</P
><DIV
CLASS="EXAMPLE"
><A
NAME="AEN276"
></A
><P
><B
>Example 3-1. Using the database class</B
></P
><TABLE
BORDER="0"
BGCOLOR="#EEEEEE"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>  // Grab one field from one record in the database
  $user_email = $q-&gt;grab_field(&quot;select email from &quot;.TBL_AUTH_USER.&quot; where user_id = 1&quot;);
  echo $user_email;

  // Stuff all the fields from a user record into an array
  $user_info = $q-&gt;grab(&quot;select * from &quot;.TBL_AUTH_USER.&quot; where user_id = 1&quot;);
  echo $user_info['email'];

  // Work with a set of records
  $q-&gt;query(&quot;select * from &quot;.TBL_AUTH_USER);
  while ($row = $q-&gt;grab()) {
    echo $row['email'].'&lt;br&gt;';
  }
      </PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN279"
>3.1.1.2. Templates</A
></H3
><P
>Instead of outputting HTML from the scripts, templates are used to separate the code from the HTML.  The templates contain tokens that are replaced by the scripts with values.  The general process for using templates is as follows:</P
><DIV
CLASS="EXAMPLE"
><A
NAME="AEN282"
></A
><P
><B
>Example 3-2. Using the template class</B
></P
><TABLE
BORDER="0"
BGCOLOR="#EEEEEE"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>  // Set up the file to be used
  $t-&gt;set_file('content', 'bugdisplay.html');

  // Substitute the tokens with data
  $t-&gt;set_var(array(
    'title' =&gt; $buginfo['title'],
    'description' =&gt; $buginfo['description'],
    ....
    ));
  
  // Parse the template and print it out (inside a wrap template)
  $t-&gt;pparse('main', array('content', 'wrap', 'main'));
      </PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN285"
>3.1.1.3. Session and Authentication</A
></H3
><P
>The session start and authentication code is included in <TT
CLASS="FILENAME"
>include.php</TT
>.  The session is started by a call to <TT
CLASS="FUNCTION"
>page_open()</TT
>, with the arguments specifying which session elements should be created.  phpBugTracker uses the <TT
CLASS="CLASSNAME"
>Auth</TT
> and <TT
CLASS="CLASSNAME"
>Perm</TT
> classes from PHPlib in addition to the base <TT
CLASS="CLASSNAME"
>Session</TT
> class.  </P
><DIV
CLASS="FORMALPARA"
><P
><B
>Session. </B
>Session variables, or variables that should be retained from page to page, are set via the <TT
CLASS="VARNAME"
>$sess</TT
> variable, which is an instantiation of the <TT
CLASS="CLASSNAME"
>usess</TT
> class.  You can register a session variable with <TT
CLASS="FUNCTION"
>$sess-&#62;register('<TT
CLASS="REPLACEABLE"
><I
>varname</I
></TT
>')</TT
>.  When registering, make sure you don't include the $ with <TT
CLASS="REPLACEABLE"
><I
>varname</I
></TT
>.  This variable will now be available in the global scope until the session is destroyed by the user closing the browser.</P
></DIV
><DIV
CLASS="FORMALPARA"
><P
><B
>Auth. </B
>The login handler is located near the end of <TT
CLASS="FILENAME"
>include.php</TT
>.  Via the <TT
CLASS="CLASSNAME"
>uath</TT
> class, the global variable <TT
CLASS="VARNAME"
>$u</TT
> is set to the user id of the user if logged in, or to 'nobody' if not logged in.  This variable should be used as the CreatedBy or LastModifiedBy value for database inserts and updates.</P
></DIV
><DIV
CLASS="FORMALPARA"
><P
><B
>Perm. </B
>There are two types of checks that are made in phpBugTracker: permission and group membership.  These checks can be made two different ways -- one that exits and displays an access denied message (useful for protecting an entire page) or one that returns whether the user passed the check (useful for determining whether to display a piece of information).</P
></DIV
><DIV
CLASS="EXAMPLE"
><A
NAME="AEN310"
></A
><P
><B
>Example 3-3. Permission and Group Checking</B
></P
><TABLE
BORDER="0"
BGCOLOR="#EEEEEE"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>  // Non-failing checks
  if ($perm-&gt;have_perm('EditBug')) {
    echo 'You can edit a bug!';
  }
  if ($perm-&gt;in_group('User')) {
    echo 'You are logged in and belong to the User group';
  }
  
  // Failing checks -- the script exits at this point if the check fails
  $perm-&gt;check('Admin');
  $perm-&gt;check_group('Developer');
	</PRE
></TD
></TR
></TABLE
></DIV
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="DEP-JPGRAPH"
>3.1.2. JpGraph</A
></H2
><P
>This section will not cover the usage of JpGraph in any detail, since it is not an integral part of phpBugTracker.  Developers who are interested in using this class for generating bug reports or charting activity can see <TT
CLASS="FILENAME"
>images.php</TT
> for an example and are encouraged to visit JpGraph's web site at <A
HREF="http://www.aditus.nu/jpgraph/"
TARGET="_top"
>http://www.aditus.nu/jpgraph</A
>.</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="configuration.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="devstandards.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Configuration Options</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Development Standards</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>