<!-- -*- sgml -*- -->
<sect1 id="dependencies">
  <title>Dependencies</title>

  <abstract>
    <para>&phpbt; requires one external package, PHPlib, and can optionally use JpGraph.  Of course a web server and a database are also necessary.</para>
  </abstract>

  <sect2 id="dep-phplib">
    <title>PHPlib</title>

    <para>PHPlib can be found at <ulink url="http://phplib.sourceforge.net/">http://phplib.sourceforge.net</ulink>.  It provides the database abstraction layer, html templates, and session and authentication management.</para>
    <sect3>
      <title>Database Abstraction</title>
      <para>Instead of using PHP's database functions directly, interactions are done via database objects, which extend PHPlib's <classname>DB_Sql</classname> class.</para>
      <para>The global variable <varname>$q</varname> is available as an instance of the class <classname>dbclass</classname>.  This class adds two functions to the <classname>DB_Sql</classname> class, <function>grab()</function> and <function>grab_field()</function>.  If they are called with an argument, the argument is passed as a query to the database and the results are returned from that query.  If no argument is passed, they return results from the previous call to <function>query()</function>.  Here are some examples:</para>
      <programlisting>
  // Grab one field from one record in the database
  $user_email = $q-&gt;grab_field(&quot;select email from &quot;.TBL_AUTH_USER.&quot; where user_id = 1&quot;);
  echo $user_email;

  // Stuff all the fields from a user record into an array
  $user_info = $q-&gt;grab(&quot;select * from &quot;.TBL_AUTH_USER.&quot; where user_id = 1&quot;);
  echo $user_info['email'];

  // Work with a set of records
  $q-&gt;query(&quot;select * from &quot;.TBL_AUTH_USER);
  while ($row = $q-&gt;grab()) {
    echo $row['email'].'&lt;br&gt;';
  }
      </programlisting>
    </sect3>
    <sect3>
      <title>Templates</title>
      <para>Instead of outputting HTML from the scripts, templates are used to separate the code from the HTML.  The templates contain tokens that are replaced by the scripts with values.  The general process for using templates is as follows:</para>
      <programlisting>
  // Set up the file to be used
  $t-&gt;set_file('content', 'bugdisplay.html');

  // Substitute the tokens with data
  $t-&gt;set_var(array(
    'title' =&gt; $buginfo['title'],
    'description' =&gt; $buginfo['description'],
    ....
    ));
  
  // Parse the template and print it out (inside a wrap template)
  $t-&gt;pparse('main', array('content', 'wrap', 'main'));
      </programlisting>
    </sect3>

  </sect2>
</sect1>

<!-- Local Variables: -->
<!-- sgml-indent-step: 2 -->
<!-- sgml-indent-data: 2 -->
<!-- sgml-parent-document: "phpbt.sgml" -->
<!-- End: -->
