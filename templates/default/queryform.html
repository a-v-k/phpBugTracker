<script type="text/JavaScript">
<!--
versions = new Array();
closedversions = new Array();
components = new Array();
versions['All'] = new Array(new Array('','All'));
closedversions['All'] = new Array(new Array('','All'));
components['All'] = new Array(new Array('','All'));
<?php build_project_js(); ?>

// Saved queries
savedQueries = new Array();
<?php for ($i = 0, $querycount = count($queries); $i < $querycount; $i++) { echo "savedQueries[$i] = '{$queries[$i]['saved_query_name']}'; "; } ?>

function updateMenus(f) {
  sel = f.projects[f.projects.selectedIndex].text;
  f.versions.length = versions[sel].length;
  for (var x = 0; x < versions[sel].length; x++) {
    f.versions.options[x].value = versions[sel][x][0];
    f.versions.options[x].text = versions[sel][x][1];
  }
  f.closedinversion.length = versions[sel].length;
  for (var x = 0; x < versions[sel].length; x++) {
    f.closedinversion.options[x].value = versions[sel][x][0];
    f.closedinversion.options[x].text = versions[sel][x][1];
  }
  f.tobeclosedinversion.length = versions[sel].length;
  for (var x = 0; x < versions[sel].length; x++) {
    f.tobeclosedinversion.options[x].value = versions[sel][x][0];
    f.tobeclosedinversion.options[x].text = versions[sel][x][1];
  }
  f.components.length = components[sel].length;
  for (var x = 0; x < components[sel].length; x++) {
    f.components.options[x].value = components[sel][x][0];
    f.components.options[x].text = components[sel][x][1];
  }
}

function checkSavedQueries(frm) {
	if (frm.savedqueryname.value != '') {
		for (i = 0; i < savedQueries.length; i++) {
			if (frm.savedqueryname.value == savedQueries[i]) {
				if (confirm('Are you sure you want to override the saved query named "' + frm.savedqueryname.value + '"?')) {
					frm.savedqueryoverride.value = 1;
					return true;
				} else {
					return false;
				}
			}
		}
	}
	return true;
}

//-->
</script>
<form method="get" action="query.php" name="query" onSubmit="return checkSavedQueries(this)">
    <table>
	<tr>
	    <th align="left"><?php echo translate("Status"); ?>:</th>
	    <th align="left"><?php echo translate("Resolution"); ?>:</th>
	    <th align="left"><?php echo translate("Operating System"); ?>:</th>
	    <th align="left"><?php echo translate("Priority"); ?>:</th>
	    <th align="left"><?php echo translate("Severity"); ?>:</th>
	    <th align="left"><?php echo translate("Database"); ?>:</th>
	    <th align="left"><?php echo translate("Reported on Site"); ?>:</th>
	</tr><tr>
	    <td align="left" valign="top">
	    	<select name="status[]" multiple size="7">
			<?php echo build_select('status'); ?>
		</select>
		</td>
	    <td align="left" valign="top">
	    	<select name="resolution[]" multiple size="7">
			<option value="0"><?php echo translate("None"); ?></option>
			<?php build_select('resolution'); ?>
		</select>
		</td>
	    <td align="left" valign="top">
	    	<select name="os[]" multiple size="7">
			<?php build_select('os'); ?>
		</select>
		</td>
	    <td align="left" valign="top">
	    	<select name="priority[]" multiple size="7">
			<?php build_select('priority'); ?>
		</select></td>
	    <td align="left" valign="top">
	    	<select name="severity[]" multiple size="7">
			<?php build_select('severity'); ?>
		</select></td>
	    <td align="left" valign="top">
	    	<select name="database[]" multiple size="7">
			<?php build_select('database'); ?>
		</select></td>
	    <td align="left" valign="top">
	    	<select name="site[]" multiple size="7">
			<?php build_select('site'); ?>
		</select></td>
	</tr>
    </table>
    <br><br>
    <table>
	<tr>
	    <td><table border="1" cellspacing="0" cellpadding="0">
		    <tr>
			<td><table cellspacing="0" cellpadding="0" border="0">
				<tr>
				    <td rowspan="2" valign="top">
				    	<select name="emailsearch1">
					    <option value="email"><?php echo translate("Email"); ?></option>
					    <option value="login"><?php echo translate("Login"); ?></option>
					</select>: 
					<input name="email1" size="30" value="">&nbsp;<?php echo translate("matching as"); ?>&nbsp;
					<select name="emailtype1">
					    <option value="rlike"><?php echo translate("regexp"); ?></option>
					    <option value="not rlike"><?php echo translate("not regexp"); ?></option>
					    <option selected value="like"><?php echo translate("substring"); ?></option>
					    <option value="="><?php echo translate("exact"); ?></option>
					</select></td>
				    <td><input type="checkbox"
					name="emailfield1[]" value="owner"
					checked><?php echo translate("Assigned To"); ?></td>
				</tr><tr>
				    <td><input type="checkbox" name="emailfield1[]"
					value="reporter"><?php echo translate("Reporter"); ?></td>
				</tr>
			    </table></td>
		    </tr>
	    </table></td>
	</tr>
    </table>
    <table border="0">
	<tr>
	    <td align="right"><?php echo translate("Summary"); ?>:</td>
	    <td><input name="title" size="30" value=""></td>
	    <td><select name="title_type">
		    <option value="like" selected><?php echo translate("substring"); ?></option>
		    <option value="rlike"><?php echo translate("regexp"); ?></option>
		    <option value="not rlike"><?php echo translate("not regexp"); ?></option>
	    </select></td>
	</tr><tr>
	    <td align="right"><?php echo translate("A description entry"); ?>:</td>
	    <td><input name="description" size="30" value=""></td>
	    <td><select name="description_type">
		    <option value="like" selected><?php echo translate("substring"); ?></option>
		    <option value="rlike"><?php echo translate("regexp"); ?></option>
		    <option value="not rlike"><?php echo translate("not regexp"); ?></option>
	    </select></td>
	</tr><tr>
	    <td align="right"><?php echo translate("URL"); ?>:</td>
	    <td><input name="url" size="30" value=""></td>
	    <td><select name="url_type">
		    <option value="like" selected><?php echo translate("substring"); ?></option>
		    <option value="rlike"><?php echo translate("regexp"); ?></option>
		    <option value="not rlike"><?php echo translate("not regexp"); ?></option>
	    </select></td>
	</tr><tr>
	<td align="right">
		<?php echo translate("Created Date Range"); ?>:
	</td>
	<td colspan="2">
		<input type="text" name="start_date" size="11"> 
		<?php echo translate("to"); ?> 
		<input type="text" name="end_date" size="11">
	</td>
	</tr><tr>
	<td align="right">
		<?php echo translate("Closed Date Range"); ?>:
	</td>
	<td colspan="2">
		<input type="text" name="closed_start_date" size="11"> 
		<?php echo translate("to"); ?> 
		<input type="text" name="closed_end_date" size="11">
	</td>
	</tr>
    </table>
    <hr align="left" width="100%">
    <table>
	<tr>
	    <td><b><?php echo translate("Project"); ?>:</b></td>
	    <td><select name="projects" onChange="updateMenus(this.form)">
		    <option value=''><?php echo translate("All"); ?></option>
		    <?php build_select('project'); ?>
		</select>
		</td>
	</tr><tr>
	    <td><b><?php echo translate("Version"); ?>:</b></td>
	    <td><select name="versions"><option value=''><?php echo translate("All"); ?></option></select></td>
	</tr><tr>
	    <td><b><?php echo translate("Closed in Version"); ?>:</b></td>
	    <td><select name="closedinversion"><option value=''><?php echo translate("All"); ?></option></select></td>
	</tr><tr>
	    <td><b><?php echo translate("To be Closed in Version"); ?>:</b></td>
	    <td><select name="tobeclosedinversion"><option value=''><?php echo translate("All"); ?></option></select></td>
	</tr><tr>
	    <td><b><?php echo translate("Component"); ?>:</b></td>
	    <td><select name="components"><option value=''><?php echo translate("All"); ?></option></select></td>
	</tr>
    </table>
    <hr align="left" width="100%">
    <input type="hidden" name="op" value="doquery">
	<input type="hidden" name="savedqueryoverride" value="0">
    <b><?php echo translate("Sort By"); ?>:</b>
    <select name="order">
	<option value="bug_id"><?php echo translate("Bug number"); ?></option>
        <option selected value="severity.sort_order"><?php echo translate("Severity"); ?></option>
        <option value="reporter.login"><?php echo translate("Reporter"); ?></option>
        <option value="status.sort_order"><?php echo translate("Status"); ?></option>
        <option value="priority"><?php echo translate("Priority"); ?></option>
    </select>
    <select name="sort">
	<option selected value="asc"><?php echo translate("Ascending"); ?></option>
	<option value="desc"><?php echo translate("Descending"); ?></option>
    </select>
    </nobr>
    <br><br>
	<?php if (!empty($_SESSION['uid'])) { ?>
		<?php echo translate("Save this query as"); ?>: <input maxlength="40" type="text" name="savedqueryname">
		<br><br>
	<?php } else { ?>
		<input type="hidden" name="savedqueryname" value="" />
	<?php } ?>
    <input type="reset" value="<?php echo translate("Reset to default query"); ?>">
    <input type="submit">
	<?php if ($querycount) { ?>
		<br><br>
		<b><?php echo translate("Saved Queries"); ?></b>
		<br>
		<?php 
			for ($i = 0; $i < $querycount; $i++) {
				echo '<a href="'.$_SERVER['PHP_SELF'].'?'.
					$queries[$i]['saved_query_string'].'">'.
					$queries[$i]['saved_query_name'].'</a> (<a href="'.
					$_SERVER['PHP_SELF'].'?op=delquery&queryid='.
					$queries[$i]['saved_query_id'].'&form=simple" onClick="return confirm(\''.translate("Are you sure you want to delete this saved query?").'\');">'.translate("Delete").'</a>)<br>';
			}
		?>
		
	<?php } ?>
</form>
<br>
<a href="query.php?op=query"><?php echo translate("Go to the simple query page"); ?></a>
